---
title: "MPH Data Analysis"
output: html_document
date: "2025-12-19"
---

```{r setup, echo = FALSE, message = FALSE}
library(geosphere)
library(knitr)
library(tidyverse)
library(dplyr)
library(readxl)
library(haven)
library(leaflet)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Import and Tidy Data

Import dataset
```{r}
data <- read_excel("data/2023_2025_nyctick.xlsx")|>
  select(-transect_100m_standard, -fraction_of_100m)
```

Export
```{r}
# Export your dataset to Excel
install.packages("writexl")  # run once
library(writexl)

write_xlsx(data, "2023_2025_nyctick.xlsx")
```


Correct for date (phenology). Describe the phenology. *Discuss at the group meeting.Can put the date as a random effect 
```{r}

```

Correct for weather?
```{r}

```

## Main Descriptive Summaries

```{r}
data |>
  group_by(transect_type) |>
  summarise(
    amblyomma_nymph_count = sum(amblyomma_americanum_nymph),
    ixodes_nymph_count = sum(ixodes_scapularis_nymph)
  ) |>
   knitr::kable()

data |>
  group_by(transect_type) |>
  summarise(
    mean_amblyomma_nymph = mean(amblyomma_americanum_nymph, na.rm = TRUE),
    mean_ixodes_nymph = mean(ixodes_scapularis_nymph, na.rm = TRUE),
    n_transects = n()
  )  |>
   knitr::kable()
```


## Extra Descriptive Summaries
Overview
```{r}
data |>
  summarise(
      Total_Transects = n(),
    Total_Ticks = sum(total, na.rm = TRUE),
    Mean_Ticks_Per_Transect = round(mean(total, na.rm = TRUE), 2),
    Max_Ticks_Single_Transect = max(total, na.rm = TRUE)
  ) |>
   knitr::kable()
```



County summary
```{r}
data |>
  group_by(county) |>
  summarise(
    Transects = n(),
    Total_Ticks = sum(total, na.rm = TRUE),
    Mean_ticks_per_transect = mean(total, na.rm = TRUE),
    Median_ticks_per_transect = median(total, na.rm = TRUE),
    Percent_transects_with_ticks = round(mean(total > 0, na.rm = TRUE) * 100, 1),
  ) |>
  arrange(desc(Total_Ticks)) |>
   knitr::kable()
```



Transect type summary
```{r}
data |>
  group_by(transect_type) |>
  summarise(
   Transects = n(),
    Total_Ticks = sum(total, na.rm = TRUE),
    Mean_ticks_per_transect = mean(total, na.rm = TRUE),
    Median_ticks_per_transect = median(total, na.rm = TRUE),
    Percent_transects_with_ticks = round(mean(total > 0, na.rm = TRUE) * 100, 1)) |> 
  arrange(desc(Total_Ticks)) |>
   knitr::kable()
```



Species counts
```{r}
data |>
  summarise(
    ixodes_total = sum(across(starts_with("ixodes")), na.rm = TRUE),
    amblyomma_total = sum(across(starts_with("amblyomma")), na.rm = TRUE),
    dermacentor_total = sum(across(starts_with("dermacentor")), na.rm = TRUE),
    haemaphysalis_total = sum(across(starts_with("haemaphysalis")), na.rm = TRUE),
    rhipicephalus_total = sum(across(starts_with("rhipicephalus")), na.rm = TRUE),
    unknown_total = sum(across(starts_with("unknown")), na.rm = TRUE)
) |>
   knitr::kable()
```



Species + life stage count
```{r}
data |>
  summarise(across(amblyomma_americanum_adult:unknown_unknown, ~sum(., na.rm = TRUE))) |>
  pivot_longer(everything(), names_to = "Species_LifeStage", values_to = "Count") |>
  arrange(desc(Count)) |>
  print() |>
   knitr::kable()
```



Species by transect type
```{r}
data |>
  group_by(transect_type) |>
  summarise(
      ixodes_total = sum(across(starts_with("ixodes")), na.rm = TRUE),
    amblyomma_total = sum(across(starts_with("amblyomma")), na.rm = TRUE),
    dermacentor_total = sum(across(starts_with("dermacentor")), na.rm = TRUE),
    haemaphysalis_total = sum(across(starts_with("haemaphysalis")), na.rm = TRUE),
    rhipicephalus_total = sum(across(starts_with("rhipicephalus")), na.rm = TRUE),
    unknown_total = sum(across(starts_with("unknown")), na.rm = TRUE)
  ) |>
  pivot_longer(-transect_type, names_to = "species", values_to = "count") %>%
  pivot_wider(names_from = transect_type, values_from = count, values_fill = 0) |>
   knitr::kable()
```



Species count in each county
```{r}
data |>
  group_by(county) |>
  summarise(
    ixodes_total = sum(across(starts_with("ixodes")), na.rm = TRUE),
    amblyomma_total = sum(across(starts_with("amblyomma")), na.rm = TRUE),
    dermacentor_total = sum(across(starts_with("dermacentor")), na.rm = TRUE),
    haemaphysalis_total = sum(across(starts_with("haemaphysalis")), na.rm = TRUE),
    rhipicephalus_total = sum(across(starts_with("rhipicephalus")), na.rm = TRUE),
    unknown_total = sum(across(starts_with("unknown")), na.rm = TRUE)
  ) |>
  pivot_longer(-county, names_to = "species", values_to = "count") |>
  pivot_wider(names_from = county, values_from = count, values_fill = 0) |>
    knitr::kable()
```

Life stages count
```{r}
data |>
  summarise(
    Adults = sum(across(ends_with("_adult")), na.rm = TRUE),
    Nymphs = sum(across(ends_with("_nymph")), na.rm = TRUE),
    Larvae = sum(across(ends_with("_larva")), na.rm = TRUE),
    Total = Adults + Nymphs + Larvae
  ) |>
    knitr::kable()
```

Life staage count by county
```{r}
data |>
  group_by(county) |>
  summarise(
    Adults = sum(across(ends_with("_adult")), na.rm = TRUE),
    Nymphs = sum(across(ends_with("_nymph")), na.rm = TRUE),
    Larvae = sum(across(ends_with("_larva")), na.rm = TRUE),
    Total = Adults + Nymphs + Larvae
  ) |>
  knitr::kable()
```

Life stage count by transect type
```{r}
data |>
  group_by(transect_type) |>
  summarise(
    Adults = sum(across(ends_with("_adult")), na.rm = TRUE),
    Nymphs = sum(across(ends_with("_nymph")), na.rm = TRUE),
    Larvae = sum(across(ends_with("_larva")), na.rm = TRUE),
    Total = Adults + Nymphs + Larvae
  ) |>
  knitr::kable()
```

